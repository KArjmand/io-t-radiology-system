<p align="center">
  <a href="http://nestjs.com/" target="blank"><img src="https://nestjs.com/img/logo-small.svg" width="120" alt="Nest Logo" /></a>
</p>

<h1 align="center">IoT X-Ray Data Management System</h1>

<p align="center">
  A NestJS-based IoT data management system for processing X-Ray data from medical devices.
</p>
## Overview

This project is an IoT X-Ray Data Management System built with NestJS, RabbitMQ, and MongoDB. It processes X-Ray data from IoT medical devices, stores the processed data, and provides RESTful API endpoints for data retrieval and analysis.

### Key Features

- **RabbitMQ Integration**: Receives X-Ray data from IoT devices via message queues
- **Data Processing**: Processes and validates incoming X-Ray data
- **MongoDB Storage**: Stores processed data in a MongoDB database
- **RESTful API**: Provides endpoints for CRUD operations and data filtering
- **Producer Simulation**: Includes a module to simulate IoT devices sending X-Ray data
- **Swagger Documentation**: Auto-generated API documentation with validation

## System Architecture

```
┌─────────────┐     ┌───────────┐     ┌─────────────┐     ┌─────────────┐
│ IoT Devices │────▶│ RabbitMQ  │────▶│ NestJS App  │────▶│  MongoDB    │
│ (Producer)  │     │ (Queue)   │     │ (Consumer)  │     │ (Database)  │
└─────────────┘     └───────────┘     └─────────────┘     └─────────────┘
                                            │
                                            ▼
                                      ┌─────────────┐
                                      │  REST API   │
                                      │  Endpoints  │
                                      └─────────────┘
```

## Prerequisites

Before running this project, make sure you have the following installed:

- Node.js (v14 or later)
- Yarn package manager
- MongoDB (local or remote instance)
- RabbitMQ (local or remote instance)

## Installation

```bash
# Clone the repository
$ git clone https://github.com/KArjmand/io-t-radiology-system

# Navigate to the project directory
$ cd io-t-radiology-system

# Install dependencies
$ yarn install
```

## Configuration

Create a `.env` file in the root directory with the following environment variables:

```env
# Port
PORT=3000

# MongoDB
MONGODB_URI=mongodb://localhost:27017/xray-data

# RabbitMQ
RABBITMQ_DEFAULT_USER=admin
RABBITMQ_DEFAULT_PASS=admin123
RABBITMQ_HOST=localhost
RABBITMQ_PORT=5672
```

## Running the Application

```bash
# Development mode
$ yarn start

# Watch mode (recommended for development)
$ yarn start:dev

# Production mode
$ yarn start:prod
```

## API Documentation

After starting the application, you can access the Swagger API documentation at:

```
http://localhost:3000/api
```

The Swagger UI provides a comprehensive interface to explore and test all available API endpoints.

### Available Endpoints

#### Signals API

- `GET /signals` - Get all signals
- `GET /signals/:id` - Get signal by ID
- `GET /signals/device/:deviceId` - Get signals by device ID
- `GET /signals/filter/data` - Filter signals by criteria (deviceId, startTime, endTime)
- `POST /signals` - Create a new signal
- `PUT /signals/:id` - Update a signal
- `DELETE /signals/:id` - Delete a signal

#### Producer API (Simulation)

- `POST /producer/send-sample` - Send sample X-Ray data to RabbitMQ
- `POST /producer/send-random` - Generate and send random X-Ray data
- `GET /producer/generate` - Generate random X-Ray data with optional deviceId

## Testing

```bash
# Run unit tests
$ yarn test

# Run e2e tests
$ yarn test:e2e

# Generate test coverage report
$ yarn test:cov
```

## Project Structure

```
src/
├── app.module.ts            # Main application module
├── main.ts                  # Application entry point
├── rabbitmq/               # RabbitMQ integration
│   ├── rabbitmq.module.ts
│   └── rabbitmq.service.ts
├── signals/                # X-Ray signals processing
│   ├── dto/                # Data Transfer Objects
│   │   ├── create-signal.dto.ts
│   │   ├── filter-signal.dto.ts
│   │   └── update-signal.dto.ts
│   ├── schemas/           # MongoDB schemas
│   │   └── xray.schema.ts
│   ├── signals.controller.ts
│   ├── signals.module.ts
│   └── signals.service.ts
└── producer/              # Producer simulation
    ├── dto/
    │   └── producer.dto.ts
    ├── producer.controller.ts
    ├── producer.module.ts
    └── producer.service.ts
```

## Data Flow

1. **Data Generation**: X-Ray data is generated by IoT devices (simulated by the Producer module)
2. **Message Queue**: Data is sent to RabbitMQ queue 'xray_queue'
3. **Data Processing**: RabbitMQ consumer receives and processes the data
4. **Data Storage**: Processed data is stored in MongoDB
5. **Data Retrieval**: Data can be retrieved via RESTful API endpoints

## Docker Support

A Docker Compose setup is available for easy deployment:

```bash
# Start the application with Docker Compose
$ docker-compose up -d

# Stop the application
$ docker-compose down
```

## License

This project is [MIT licensed](LICENSE).
